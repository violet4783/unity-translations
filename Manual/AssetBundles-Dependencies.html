<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: AssetBundle Dependencies</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://docs.unity3d.com/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1586228985"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1586228985"></script><script type="text/javascript" src="docdata/toc.js?ts=1586228985"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1586228985"></script><link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1586228985">
<link rel="stylesheet" href="../StaticFilesManual/css/prism.css">
<script src="../StaticFilesManual/js/prism.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><script src="../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../StaticFilesManual/css/mobileoptimisation.css">
<script src="../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div id="DocsAnalyticsData" data-area="cloud" data-pagetype="manual"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>2019.3</b><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/AssetBundles-Dependencies.html">English</a></li>
<li><a href="/ja/current/Manual/AssetBundles-Dependencies.html">日本語</a></li>
<li><a href="/es/current/Manual/AssetBundles-Dependencies.html">Español</a></li>
<li><a href="/kr/current/Manual/AssetBundles-Dependencies.html">한국어</a></li>
<li><a href="/ru/current/Manual/AssetBundles-Dependencies.html">Русский</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: 2019.3</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/AssetBundles-Dependencies.html">English</a></li>
<li><a href="/ja/current/Manual/AssetBundles-Dependencies.html">日本語</a></li>
<li><a href="/es/current/Manual/AssetBundles-Dependencies.html">Español</a></li>
<li><a href="/kr/current/Manual/AssetBundles-Dependencies.html">한국어</a></li>
<li><a href="/ru/current/Manual/AssetBundles-Dependencies.html">Русский</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.3)</a></li>
<li><a href="UnityOverview.html"> Working in Unity</a></li>
<li><a href="AssetWorkflow.html"> Asset workflow</a></li>
<li><a href="AssetBundlesIntro.html"> AssetBundles</a></li>
<li>AssetBundle Dependencies</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="AssetBundles-Building.html"></a></span><div class="tip"> Building AssetBundles</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="AssetBundles-Native.html"></a></span><div class="tip"> Using AssetBundles Natively</div>
</div>
</div></div>
<div id="_leavefeedback"></div>
<h1>AssetBundle Dependencies</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>AssetBundles can become dependent on other AssetBundles if one or more of the <code>UnityEngine.Objects</code> contains a reference to a <code>UnityEngine.Object</code> located in another bundle. A dependency does not occur if the <code>UnityEngine.Object</code> contains a reference to a <code>UnityEngine.Object</code> that is not contained in any AssetBundle. In this case, a copy of the object that the bundle would be dependent on is copied into the bundle when you build the AssetBundles. If multiple objects in multiple bundles contain a reference to the same object that isn’t assigned to a bundle, every bundle that would have a dependency on that object will make its own copy of the object and package it into the built AssetBundle.</p>

<p>Should an AssetBundle contain a dependency, it is important that the bundles that contain those dependencies are loaded before the object you’re attempting to instantiate is loaded. Unity will not attempt to automatically load dependencies.</p>

<p>Consider the following example, a Material in <strong>Bundle 1</strong> references a Texture in <strong>Bundle 2</strong>:</p>

<p>In this example, before loading the Material from <strong>Bundle 1</strong>, you would need to load <strong>Bundle 2</strong> into memory. It does not matter which order you load <strong>Bundle 1</strong> and <strong>Bundle 2</strong>, the important takeaway is that <strong>Bundle 2</strong> is loaded before loading the Material from <strong>Bundle 1</strong>. In the next section, we’ll discuss how you can use the <code>AssetBundleManifest</code> objects we touched on in the previous section to determine, and load, dependencies at runtime.</p>

<h2>Duplicated information across AssetBundles</h2>

<p>This section describes how Unity deals with duplicated information across AssetBundles. The scenario discuessed in <a href="#EditorSetup">Editor Setup</a> is still applicable to the <a href="http://docs.unity3d.com/Packages/com.unity.addressables@latest/index.html">Unity Addressable Asset System</a> (‘Addressables’). The technique described in <a href="#RuntimeLoading">Runtime loading</a> is automatically performed in the background by the Addressables system.</p>

<p><a name="EditorSetup"></a></p>

<h3>Editor setup</h3>

<p>Unity doesn’t minimize the amount of duplicated information across AssetBundles by default. Unless explicitly stated, or a dependency graph is established, Unity also includes copies of any implicitly referenced assets.</p>

<p>For example, you could have an application with two <span class="tooltip"><strong>prefabs</strong><span class="tooltiptext">An asset type that allows you to store a GameObject complete with components and properties. The prefab acts as a template from which you can create new object instances in the scene. <a href="Prefabs.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Prefab">Glossary</a></span></span></span> <code>NuclearElectricityGenerator-Medium</code> and <code>ProductionCrystals-Large</code>, and each one is assigned to its own AssetBundle.</p>

<p>The image below shows an asset with an AssetBundle.</p>

<figure>
<img src="../uploads/Main/AssetWithBundle.png" alt="">
</figure>

<p>Both prefabs share the same <code>SpaceStationModules-Material-Active</code> material, which is not assigned to an AssetBundle. This material references the <code>SpaceStationModules-Material-Active</code> texture, which is not assigned to an AssetBundle either.</p>

<p>The image below shows an asset without an AssetBundle.</p>

<figure>
<img src="../uploads/Main/AssetWithoutBundle.png" alt="">
</figure>

<p>If you build the AssetBundles using the <code>CreateAssetBundles</code> class described in <a href="#AssetBundles-Workflow">AssetBundle Workflow</a>, each generated AssetBundle contains the material (including its shader and referenced textures). In the example image below, the prefabs have a size of 383 KB and 377 KB respectively.</p>

<figure>
<img src="../uploads/Main/AssetBundleDuplicate.png" alt="">
</figure>

<p>If the project contains a larger number of prefabs, this behaviour impacts the final installer size, and also runtime memory footprint when both AssetBundles are loaded. Data duplication across AssetBundles also impacts batching, because Unity considers the various copies of the same material as unique materials.</p>

<p>To avoid data duplication, assign the material and its referenced assets to its own <code>modulesmaterials</code> AssetBundle. You can also tag the material only, because the texture dependency is also included in the AssetBundle during the build process.</p>

<p>The image below shows an asset with the <code>modulesmaterials</code> AssetBundle added.</p>

<figure>
<img src="../uploads/Main/AssetWithBundleAdded.png" alt="">
</figure>

<p>Now if you rebuild the AssetBundles, the generated output includes a separate “modulesmaterials” AssetBundle (359 KB), which contains the material and its associated texture. This significantly reduces the size of the other AssetBundles for the prefabs (from roughly 380 KB in the previous iteration down to roughly 20 KB).</p>

<p>The image below illustrates this.</p>

<figure>
<img src="../uploads/Main/AssetBundleSeparate.png" alt="">
</figure>

<p><a name="RuntimeLoading"></a></p>

<h3>Runtime loading</h3>

<p>When you extract common assets to a single AssetBundle, be careful about dependencies. In particular, if you try to instantiate a module by loading its prefab only, using a variation of the example in <a href="#AssetBundles-Native">Using AssetBundles Natively</a>, the materials do not load:</p>

<pre><code>using System.IO;
using UnityEngine;

public class InstantiateAssetBundles : MonoBehaviour
{
    void Start()
    {
        var moduleAB = AssetBundle.LoadFromFile(Path.Combine(Application.dataPath, Path.Combine(&quot;AssetBundles&quot;, &quot;nuclearelectricitygenerator-medium&quot;)));

        if (moduleAB == null)
        {
            Debug.Log(&quot;Failed to load AssetBundle!&quot;);
            return;
        }
        var prefab = moduleAB.LoadAsset&lt;GameObject&gt;(&quot;nuclearelectricitygenerator-medium&quot;);
        Instantiate(prefab);
    }
}

</code></pre>

<p>The image below shows an example where the material has not loaded.</p>

<figure>
<img src="../uploads/Main/MaterialNotLoaded.png" alt="">
</figure>

<p>To solve this problem, load the materials AssetBundle in memory before you load the AssetBundle that belongs to the module. To do this, add the following statement at the top of the Start() function:</p>

<pre><code>var materialsAB = AssetBundle.LoadFromFile(Path.Combine(Application.dataPath, Path.Combine(&quot;AssetBundles&quot;, &quot;modulesmaterials&quot;)));
</code></pre>

<p>The image below shows an example where the material has loaded correctly, using the method above.</p>

<figure>
<img src="../uploads/Main/MaterialLoaded.png" alt="">
</figure>

<p>
<strong>Note:</strong> When using LZ4 compressed and uncompressed AssetBundles, the <a href="#ScriptRef:AssetBundle.LoadFromFile.html">AssetBundle.LoadFromFile</a> method only loads the catalog of its content in memory, but not the content itself. To confirm this behaviour use the <a href="https://docs.unity3d.com/Packages/com.unity.memoryprofiler@0.2/manual/index.html">Memory Profiler</a> package.</p>
<!-- area:cloud -->
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="AssetBundles-Building.html"></a></span><div class="tip"> Building AssetBundles</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="AssetBundles-Native.html"></a></span><div class="tip"> Using AssetBundles Natively</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2020 Unity Technologies. Publication Date: 2020-04-07.</div>
<div class="menu">
<a href="https://learn.unity.com/">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
